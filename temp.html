<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">


<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
<link rel="stylesheet" type="text/css"
	href="css/bootstrap-theme.min.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<script src="js/jquery-1.9.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="fonts"></script>
<title>log in</title>
</head>
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif; color:#e5e5e5;}
.nohover:hover{
	background: #17202A;
	color:white;
}

.sq{
	height:90%;
}

</style>
<body>
<div class="container-fluid">
	<div class="row">
		<div class="col-md-3" style="margin-top:2em;">
			<div class="col-md-12" name="square" style="background-color:#1ba2c4;">
			<h2 id="details"></h2>
			<hr>
			<h4><div class="row"><div class=col-md-1><span class="glyphicon glyphicon-user"></span></div><div id="actype" class="col-md-10"></div></h4>
			<h4 id="hostelParent" style="display:none;"><div class="row"><div class=col-md-1><span class="glyphicon glyphicon-home"></span></div><div id="hostel" class="col-md-10"></div></h4>
			<h4 id="rollnoParent" style="display:none;"><div class="row"><div class=col-md-1><span class="glyphicon glyphicon-option-vertical"></span></div><div id="rollno" class="col-md-10"></div></h4>
			<h4><div class="row"><div class=col-md-1><span class="glyphicon glyphicon-envelope"></span></div><div id="email" class="col-md-10"></div></h4>
			<h4><div class="row"><div class=col-md-1><span class="glyphicon glyphicon-phone-alt"></span></div><div id="mobile" class="col-md-10"></div></div></h4>
			</div>
			<div class="row">
				<div class="col-md-6" style="margin-top:2em;"><button type="button" id="logout" class="btn btn-lg btn-block" style="background-color:#ff6161; color: white; border-radius:0px;">Log Out</button></div>
				<div class="col-md-6" style="margin-top:2em;"><button type="button" id="edit" class="btn btn-lg btn-block" style="background-color:#6af295; color: white; border-radius:0px;">Edit Details</button></div>
			</div>
		</div>
		<div class="col-md-9" style="margin-top: 2em;">
		<div class="col-md-12" style="background-color:#1ba2c4;">
			<h2 id="details">Lodge</h2>
			<hr>
			</div>
		<div class="col-md-12" style="background-color: #ededed;">
			<div id="lodgeSuccess" style="display:none;"><h2 style="color:black;">Complaint Registered</h2></div>
			<form id="lodge" name="lodge" method="post" action="/lodge">
				<div style="margin-top:1em; color:black;">
				<input id="student_id" name="student_id" value="" style="display:none;">
				<div class="col-md-2">
					<h4 style="text-align: center; font-family: 'Roboto', sans-serif; color:black;">Type</h4>
					<p></p>
					<select class="form-control" id="type" name="type">
					    <option>Select</option>
					    <option>hostel</option>
					    <option>personnel</option>
					</select>
				</div>
				<div class="col-md-2">
					<h4 style="text-align: center;font-family: 'Roboto', sans-serif; color:black;">Equipment</h4>
					<p></p>
					<select class="form-control" id="equipment" name="subject">
					</select>
				</div>
				<div class="col-md-2">
					<h4 style="text-align: center;font-family: 'Roboto', sans-serif; color:black;">Assistance</h4>
					<p></p>
					<input class="form-control" id="assistance" style="text-align: center; border:none; background-color:transparent;" value="None" readonly name="category">
				</div>
				<div class="col-md-2">
					<h4 style="text-align: center;font-family: 'Roboto', sans-serif; color:black;">Slot</h4>
					<p></p>
					<select class="form-control" id="slot" name="time_slot">
					    <option>10:00-12:00</option>
					    <option>1:00-15:00</option>
					    <option>16:00-18:00</option>
					</select>
				</div>
				<div class="col-md-3">
					<h4 style="text-align: center;font-family: 'Roboto', sans-serif; color:black;">Description</h4>
					<p></p>
					<div class="form-group">
					<input class="form-control" id="assistance" name="description">
					</div>
				</div>
				<div class="col-md-1">
					<div class="form-group" style="text-align: center;">
					<input type="submit" class="btn" style="margin-top:2em;background-color:#1ba2c4; color:white ; border-radius:0px;" value="Lodge">
					</div>
				</div>
				<hr>
				</div>
			</form>
			</div> 
		</div>
		</div>
	</div>
</div>
</body>

</html>

<script>
$("[name='square']").css("height",$("[name='square']").width());
$( "#logout" )
	.mouseover(function() {
	$( this ).css("background-color","#e55757");
	})
	.mouseout(function() {
	$( this ).css("background-color","#ff6161");
});

$( "#edit" )
	.mouseover(function() {
	$( this ).css("background-color","#5fd986");
	})
	.mouseout(function() {
	$( this ).css("background-color","#6af295");
});

$("[name='square']").css("height",$("[name='square']").width());
console.log()


$.ajax({
	type: 'get',
	url: '/userData',
	success: function (data) {
		console.log(data);
		if(data=="false")
			window.location.href = "./";
		else{
			var value=JSON.parse(data);
			console.log(value);
			$("#details").html(value[0].name);
			if(value[0].student_id){
				$("#student_id").val(value[0].student_id);
				//console.log("aaa "+$("#student_id").val());
				$("#actype").html("&nbsp;&nbsp; Student");
				$("#hostel").html("&nbsp;&nbsp; "+value[0].gender+" "+value[0].room_no);
				$("#hostelParent").css("display","block");
				$("#rollno").html("&nbsp;&nbsp; "+value[0].roll_no);
				$("#rollnoParent").css("display","block");
			}
			if(value[0].admin_id){
				$("#actype").html("&nbsp;&nbsp; Admin");
			}
			if(value[0].handyman_id){
				$("#actype").html("&nbsp;&nbsp; Handyman");
				$("#rollno").html("&nbsp;&nbsp; "+value[0].Catagory);
				$("#rollnoParent").css("display","block");
			}
			$("#email").html("&nbsp;&nbsp; "+value[0].email);
			$("#mobile").html("&nbsp;&nbsp; "+value[0].phone_no);
		}
	}	
});

var lodge = $('#lodge');
lodge.submit(function () {
	$.ajax({
		type: lodge.attr('method'),
		url: lodge.attr('action'),
		data: lodge.serialize(),
		success: function (data) {
			if(data=="true"){
				$("#lodge").fadeOut(500).promise().done(function(){
			 		$("#lodgeSuccess").fadeIn(1000).promise().done(function(){
			 			$("#lodgeSuccess").fadeOut(500).promise().done(function(){
			 				$("#lodge").fadeIn(500);
			 			});
			 		});
		 		});
			}
		}	
	});
	return false;
});

$('#logout').click(function(){
	$.ajax({
		type: 'get',
		url: '/logout',
		success: function(data){
			if(data=="true"){
				window.location.href="./";
			}
		}
	});
});

var values={};
$( "#type" ).change(function() {
  	$.ajax({
		type: 'get',
		url: '/complaint',
		data: { 
        "type": $("#type").val()
    	},
		success: function(data){
			data=JSON.parse(data);
			values={};
			for(var i=0;i<data.length;++i){
				var temp=data[i].equipment;
				values[temp]=data[i].handman;
			}
			$('#equipment option').remove();
			$.each(values, function (i, items) {
			    $('#equipment').append($('<option>', {
			        text : i 
			    }));  
			});
			$("#assistance").val(values[$("#equipment").val()]);
		}
	});
});

$( "#equipment" ).change(function(){
	$("#assistance").val(values[$(this).val()]);
});

</script>